var oop = require('oop');

var prelude = require('prelude-ls');


/**
 * Model for a source code.
 *
 * Kind of equivalent (but more specific) to the Document model in Eclipse.
 */
var Code = oop.class({
	name: 'Code',

	constructor: function(parser, input) {
		this.parser = parser;
		this.source = '';
		this.graph = undefined;
		if (input != null) {
			this.update(input);
		}
	},

	prototype: {
		update: function(input) {
			var spec = oop.processProperties({}, input, {
				inputToSpec: {
					'String': 'text'
				},
				properties: [
					{
						names: ['text', 'source', 'src', 'content'],
						default: ''
					},
					{
						names: ['start', 'beginning', 'offset', 'index'],
						default: 0
					},
					{
						names: ['end', 'stop'],
						default: this.source.length - 1
					}
				]
			});

			this.source =
				this.source.substring(0, spec.start) +
				spec.text +
				this.source.substring(spec.end, this.source.length - 1);

			this.graph = this.parser.parse(this.source);
		}
	}
})



exports.Code = Code;
